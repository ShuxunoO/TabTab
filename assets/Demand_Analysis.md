我想做一款AI私人定制输入法项目，产品特点是可以使用用户的私人数据（微信聊天记录，QQ聊天记录等）训练模型，输入法就可以像AI编辑器代码补全一样，在用户聊天或者输入文档的时候，按Tab键就可以基于用户上私域数据的下文不断联想，补全或者润色用户输入信息。输入法可以允许用户预定义4种场景，（通过预定义Prompt，用的时候动态切换）



### 核心价值主张：
1. **深度个性化**：基于用户私域数据（聊天记录、文档等）训练，真正理解用户的表达习惯
2. **场景智能**：支持多场景切换，适应用户在不同情境下的输入需求


### 目标用户群体：
- 经常进行文本输入的职场人士
- 需要在不同场合切换写作风格的内容创作者
- 重视输入效率的普通用户
- 关注数据隐私的安全意识用户

## Python实现Windows输入法方案分析

与原方案不同，我们将使用Python实现一个Windows兼容的输入法，不再依赖rime等C++方案，但保持兼容rime预定义词库的能力。

### 主要特点：
- **纯Python实现**: 使用Python全栈开发，简化开发难度和维护成本
- **全局键盘监听**: 通过Python库实现全局键盘事件捕获
- **拼音引擎集成**: 集成开源拼音转换引擎，支持基础拼音输入
- **词库兼容性**: 兼容rime等输入法的预定义词库格式
- **AI补全集成**: 与本地AI服务无缝集成，提供智能文本补全

### 输入法实现思路:
Windows环境下纯Python实现输入法不同于传统TSF架构，我们采用键盘钩子(keyboard hook)方案，利用浮动窗口展示候选词，通过模拟按键实现文本输入。

## 总体架构概览

AI私人定制输入法将由以下核心组件构成：

1. **Python输入法客户端**:
   - 通过键盘钩子捕获全局键盘事件
   - 维护输入缓冲区和候选词窗口
   - 实现拼音到汉字的转换
   - 与AI服务通信获取补全建议
   - 响应Tab键触发补全操作
   - Ai 补全的内容无法被输入到输入框中，默认是单击tab键将输入法第一行的内容写入到输入框，双击tab键来触发补全。不按tab键时，输入框中的内容就是键盘输入的内容。



2. **本地AI推理服务**:
   - 负责加载并运行AI模型
   - 接收输入法客户端发送的上下文
   - 生成文本补全建议（前3个候选项）
   - 提供HTTP API接口供输入法客户端调用

3. **云服务**:
   - 预留云服务的api接口
   - 将用户请求转发给本地AI推理服务，并将结果返回给用户在输入法客户端显示


## 技术栈选择

### 输入法框架:
- **键盘监听**: pynput 或 keyboard 库用于全局键盘事件捕获
- **GUI界面**: PyQt6 或 wxPython 实现输入法候选词窗口
- **文本模拟**: pyautogui 或 pywin32 实现文本输入模拟
- **拼音引擎**: pypinyin + jieba 实现拼音转换和分词

### 词库兼容:
- **词库解析**: PyYAML 解析rime词库文件
- **模糊匹配**: Levenshtein 算法实现模糊音匹配


## 主要开发任务:

1. **Python输入法核心开发**:
   - 实现全局键盘事件监听
   - 开发浮动输入窗口和候选词展示
   - 实现基础拼音输入功能
   - 集成rime词库解析和加载

2. **AI服务集成**:
   - 实现本地HTTP API调用接口
   - 开发上下文管理和文本补全逻辑
   - 集成Tab键触发补全功能
   - 实现场景切换热键支持

3. **AI推理服务开发**:
   - 部署轻量级Qwen模型
   - 优化CPU推理性能
   - 实现API服务端点



## 用户输入流程

1. **基础拼音输入流程**:
   - 用户键入拼音 → 输入法捕获并显示在输入窗口
   - 输入法查询词库生成候选词 → 用户选择或继续输入
   - 用户选择候选词或按空格 → 输入法通过模拟按键输入选中文本

2. **AI补全流程**:
   - 用户输入文本 → 输入法捕获并维护上下文
   - 同时，将上下文发送给AI服务 → AI服务生成预测
   - AI补全结果在候选词中特殊显示
   - 用户按Tab键 → 采纳AI补全建议 → 补全文本

3. **场景切换流程**:
   - 用户通过热键(Ctrl+Shift+1/2/3/4)切换场景
   - 输入法加载对应场景提示词和设置
   - AI服务根据场景调整生成策略

## TabTab Python输入法实现方案

### 核心组件

1. **InputManager**: 核心输入管理模块
   - 管理键盘事件监听和处理
   - 维护输入状态和缓冲区
   - 调度各功能模块

2. **PinyinEngine**: 拼音处理引擎
   - 实现拼音到汉字的转换
   - 管理词库和候选词生成
   - 支持模糊音和简拼功能

3. **CandidateWindow**: 候选词窗口
   - 显示拼音候选词和AI补全建议
   - 响应数字键选择和翻页
   - 跟随光标位置移动

4. **AIClient**: AI服务客户端
   - 与本地AI服务通信
   - 发送上下文和接收补全建议
   - 处理异步请求和响应

5. **DictionaryManager**: 词库管理器
   - 加载和解析rime词库文件
   - 管理自定义词库和用户词频
   - 提供高效词汇查询接口

### API调用规范
- 服务地址: `http://localhost:11434/api/generate`
- 请求方法: POST
- 内容类型: application/json
- 默认模型: qwen3:0.6b
- 响应格式: JSON包含生成的文本补全建议
- 开发的时候先试用ollama做测试：
   
   ``` python  
   from ollama import Client
   client = Client(
   host='http://localhost:11434',
   headers={'x-some-header': 'some-value'}
   )
   response = client.chat(model='llama3.2-vision', messages=[
   {
      'role': 'user',
      'content': 'Why is the sky blue?',
   },
   ])

   print(response.get("message")["content"])




### 场景配置
1. **女朋友**: 揣度、分析女朋友心思，避免不必要的争吵
2. **员工模式**: 客气、礼貌，适合工作场合
3. **写作模式**: 文学创作、博客写作
4. **暴走模式**: 喷人，互怼

## 技术实现挑战与解决方案

1. **键盘事件处理**:
   - **挑战**: Windows下全局键盘事件捕获可能被安全软件阻止
   - **解决方案**: 提供多种键盘监听方式(pynput/pyHook/keyboard)

2. **光标位置跟踪**:
   - **挑战**: 准确获取各应用程序中的光标位置
   - **解决方案**: 结合Win32 API和启发式方法确定光标位置

3. **拼音匹配性能**:
   - **挑战**: 大词库下的实时匹配性能
   - **解决方案**: 使用前缀树(Trie)结构和缓存机制优化查询



## 兼容性与扩展性

1. **词库兼容性**:
   - 支持rime、搜狗、百度等主流输入法词库格式
   - 提供词库转换和导入工具


2. **插件扩展**:
   - 提供插件系统支持功能扩展
   - 允许自定义皮肤和UI主题

## 路线图与发展计划

1. **基础版(v0.1)**:
   - 实现基本拼音输入功能
   - 支持加载预定义词库
   - 简单浮动窗口界面

2. **AI集成版(v0.2)**:
   - 集成本地AI服务
   - 实现Tab键补全
   - 基础场景切换功能